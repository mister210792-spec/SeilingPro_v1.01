<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ceiling Plan PRO - SaaS Edition</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card" id="login-form">
        <h1>–í—Ö–æ–¥ –≤ Ceiling Plan</h1>
        <input type="email" id="email" class="auth-input" placeholder="E-mail">
        <input type="password" id="pass" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="auth-btn" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
        <div class="auth-switch" onclick="toggleAuthForms()">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</div>
    </div>

    <div class="auth-card" id="reg-form" style="display:none;">
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        <input type="text" id="reg-name" class="auth-input" placeholder="–ò–º—è">
        <input type="email" id="reg-email" class="auth-input" placeholder="E-mail">
        <input type="password" id="reg-pass" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
        <h3 style="margin: 15px 0 10px; font-size: 14px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ:</h3>
        <div class="pricing-container">
            <div class="price-card active" id="p-free" onclick="selectPlan('free')">
                <h4>FREE</h4>
                <div class="cost">0‚ÇΩ</div>
                <ul>
                    <li>‚úì 1 –ö–æ–º–Ω–∞—Ç–∞</li>
                    <li>‚úì –ë–∞–∑–æ–≤—ã–π –ø—Ä–∞–π—Å</li>
                    <li>‚úó –°–≤–æ–∏ —ç–ª–µ–º–µ–Ω—Ç—ã</li>
                </ul>
            </div>
            <div class="price-card" id="p-pro" onclick="selectPlan('pro')">
                <h4>PRO <span class="badge-pro">HIT</span></h4>
                <div class="cost">490‚ÇΩ/–º–µ—Å</div>
                <ul>
                    <li>‚úì –ë–µ–∑–ª–∏–º–∏—Ç –∫–æ–º–Ω–∞—Ç</li>
                    <li>‚úì –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω–∞–º–∏</li>
                    <li>‚úì –°–≤–æ–∏ —ç–ª–µ–º–µ–Ω—Ç—ã</li>
                </ul>
            </div>
        </div>
        <button class="auth-btn" style="margin-top:20px;" onclick="handleRegister()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        <div class="auth-switch" onclick="toggleAuthForms()">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</div>
    </div>
</div>

<div class="header">
    <h2>CEILING <span style="color: var(--primary);">PLAN v4.0 SaaS</span></h2>
    <div class="user-info">
        <div class="plan-status" id="header-plan">–ü–ª–∞–Ω: FREE</div>
        <div id="header-user">–ó–∞–º–µ—Ä—â–∏–∫</div>
        <button onclick="handleLogout()" style="width: auto; padding: 5px 10px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">–í—ã—Ö–æ–¥</button>
    </div>
    <div class="project-controls" style="display: flex; gap: 8px; margin-left: 10px; border-left: 1px solid #eee; padding-left: 15px;">
    <button onclick="saveProject()" class="action-btn" style="background: var(--success); color: white; border: none; padding: 0 15px; height: 36px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 5px;">
        <span>‚úÖ</span> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    </button>
    <button onclick="openProjectsModal()" class="action-btn" style="background: white; color: var(--dark); border: 1px solid #ddd; padding: 0 15px; height: 36px; border-radius: 8px; cursor: pointer; font-weight: 500;">
        –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
    </button>
</div>
    <div style="display: flex; gap: 10px;">
        <button onclick="undo()" style="width: auto; padding: 0 15px;" ontouchstart="event.stopPropagation()">–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)</button>
        <button onclick="exportImage()" style="background: none; color: white; border-color: rgba(255,255,255,0.3); width: auto; padding: 0 15px;">üíæ PNG</button>
        <button onclick="printPDF()" style="background: var(--success); color: white; border: none; font-weight: bold; width: auto; padding: 0 15px;">üñ®Ô∏è –ü–µ—á–∞—Ç—å PDF</button>
    </div>
</div>

<div class="main-layout">
    <div class="drawing-zone">
        <div id="tabs"></div>
        <div id="canvas-container">
            <svg id="canvas" xmlns="http://www.w3.org/2000/svg"></svg>
        </div>
    </div>

    <div class="side-menu">
        <div class="menu-section">
            <h3>–í–∏–¥</h3>
            <div class="btn-group" style="flex-direction: row; gap: 4px;">
                <button id="toggleDiags" onclick="toggleDiagonals()" class="btn-toggle-active" style="font-size: 11px;">üìê –î–∏–∞–≥–æ–Ω–∞–ª–∏</button>
                <button id="toggleMeasures" onclick="toggleMeasures()" class="btn-toggle-active" style="font-size: 11px;">üìè –†–∞–∑–º–µ—Ä—ã –¥–æ–ø.</button>
            </div>
            <p style="font-size: 10px; color: #666; margin-top: 5px;">* –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ <b>Shift</b> –¥–ª—è –ø—Ä–æ–∏–∑–≤. —É–≥–ª–æ–≤ / <b>Alt+Drag</b> –¥–ª—è –∫–æ–ø–∏–∏</p>
        </div>

        <div class="menu-section">
            <h3>–û—Å–≤–µ—â–µ–Ω–∏–µ</h3>
            <div class="btn-group">
                <select id="lightTypeSelector"></select>
                <button id="tool-light" onclick="setTool('light')">üí° –î–æ–±–∞–≤–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ</button>
            </div>
        </div>

        <div class="menu-section">
            <h3>–ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</h3>
            <div class="btn-group">
                <select id="extraTypeSelector"></select>
                <button id="tool-extra" onclick="setTool('extra')">üõ†Ô∏è –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü. —ç–ª–µ–º–µ–Ω—Ç</button>
            </div>
        </div>

        <div class="menu-section">
            <h3>–ì–∞—Ä–¥–∏–Ω—ã –∏ –¥–æ–ø.</h3>
            <div class="btn-group">
                <select id="railTypeSelector"></select>
                <button id="tool-rail" onclick="setTool('rail')">üìè –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä–Ω–∏–∑</button>
                <button id="tool-pipe" onclick="setTool('pipe')">üîò –û–±–≤–æ–¥ —Ç—Ä—É–±—ã</button>
            </div>
        </div>

        <div class="menu-section">
            <h3>–ü–æ–º–µ—â–µ–Ω–∏—è</h3>
            <button class="btn-primary" onclick="addRoom()" style="border-color: var(--primary); color: var(--primary);">+ –ù–æ–≤–æ–µ –ø–æ–ª–æ—Ç–Ω–æ</button>
            <button onclick="mirrorRoom()" style="margin-top: 8px; border-color: #9c27b0; color: #9c27b0;">‚Üî –û—Ç—Ä–∞–∑–∏—Ç—å –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏</button>
        </div>

        <div class="stat-card">
            <div id="roomTitle" onclick="renameRoom()">–¢–µ–∫—É—â–∏–π –∑–∞–º–µ—Ä</div>
            <div class="stat-row"><span>–ü–ª–æ—â–∞–¥—å:</span> <span id="currentArea" class="stat-val">0.00 –º¬≤</span></div>
            <div class="stat-row"><span>–ü–µ—Ä–∏–º–µ—Ç—Ä:</span> <span id="currentPerim" class="stat-val">0.00 –º</span></div>
        </div>

        <div class="menu-section">
             <h3>–°–º–µ—Ç–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h3>
             <div id="elementsList" class="estimate-list">–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤</div>
             <button onclick="generateFullEstimate()" style="margin-top: 10px; background: var(--dark); color: white; border: none;">üìã –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Å–º–µ—Ç—É</button>
            <button onclick="exportEstimateToExcel()" style="margin-top: 5px; background: #27ae60; color: white; border: none;">üìä Excel</button>
             <button onclick="openPriceModal()" style="margin-top: 5px; background: #90a4ae; color: white; border: none;">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–π—Å–æ–º</button>
        </div>

        <div class="total-card">
            <div style="font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.3); margin-bottom: 8px; padding-bottom: 4px;">–ò–¢–û–ì–û –ü–û –û–ë–™–ï–ö–¢–£</div>
            <div class="stat-row"><span>–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å:</span> <span id="totalArea" class="total-val">0.00 –º¬≤</span></div>
            <div class="stat-row"><span>–û–±—â–∏–π –ø–µ—Ä–∏–º–µ—Ç—Ä:</span> <span id="totalPerim" class="total-val">0.00 –º</span></div>
            <div id="totalElements" style="font-size: 11px; margin-top: 5px; opacity: 0.9;"></div>
        </div>
    </div>
</div>

<div id="priceModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color: var(--dark);">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∏ —Ü–µ–Ω–∞–º–∏</h3>
        
        <div id="priceListContainer"></div>

        <div id="custom-el-block" style="position: relative;">
            <button id="btnShowAdd" onclick="toggleAddForm()" style="background: #e1f5fe; color: #0288d1; border: 1px dashed #0288d1; margin-bottom: 15px;">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç</button>
            
            <div id="addForm" class="add-form">
                <h4 style="margin-top:0;">–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç</h4>
                <div class="form-row">
                    <input type="text" id="newElName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. –í—ã—Ç—è–∂–∫–∞)">
                    <input type="number" id="newElPrice" placeholder="–¶–µ–Ω–∞ (—Ä—É–±.)">
                </div>
                <div class="form-row">
                    <select id="newElType" onchange="toggleShapeSelect()">
                        <option value="static">–®—Ç—É—á–Ω—ã–π (–°—Ç–∞—Ç–∏—á–Ω—ã–π)</option>
                        <option value="linear">–õ–∏–Ω–µ–π–Ω—ã–π (–ú–µ—Ç—Ä–∞–∂)</option>
                        <option value="service">–£—Å–ª—É–≥–∞ (–î–æ–ø. —Ä–∞–±–æ—Ç–∞)</option>
                    </select>
                    <select id="newElShape">
                        <option value="circle">–§–æ—Ä–º–∞: –ö—Ä—É–≥</option>
                        <option value="square">–§–æ—Ä–º–∞: –ö–≤–∞–¥—Ä–∞—Ç</option>
                        <option value="triangle">–§–æ—Ä–º–∞: –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫</option>
                        <option value="diamond">–§–æ—Ä–º–∞: –†–æ–º–±</option>
                    </select>
                </div>
                <div class="form-row">
                    <button onclick="addNewElementConfirm()" style="background: var(--success); color: white;">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="toggleAddForm()" style="background: #eee;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <div id="price-lock" class="lock-overlay">
                <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div style="font-size: 24px;">üîí</div>
                    <div style="font-weight: bold; margin: 5px 0;">–î–æ—Å—Ç—É–ø–Ω–æ –≤ PRO</div>
                    <p style="font-size: 11px; color: #666;">–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –≤ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏</p>
                </div>
            </div>
        </div>

        <div style="display:flex; gap:10px; margin-top:20px; border-top: 1px solid #eee; padding-top: 15px;">
            <button onclick="savePrices()" style="background: var(--dark); color: white; border: none;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <button onclick="closePriceModal()" style="background: #eee; border: none;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<div id="print-container"></div>

<!-- Firebase SDKs (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç) -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
  // –¢–≤–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBe4dfQAk6aiMHlZv2p3KqMw8dXrrS6pNM",
    authDomain: "seiling-plan-pro.firebaseapp.com",
    projectId: "seiling-plan-pro",
    storageBucket: "seiling-plan-pro.firebasestorage.app",
    messagingSenderId: "536435562249",
    appId: "1:536435562249:web:063858060492dc6f47a5d8",
    measurementId: "G-6TXYE369QD"
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  firebase.initializeApp(firebaseConfig);
  console.log("‚úÖ Firebase –∑–∞–≥—Ä—É–∂–µ–Ω —Å –ø—Ä–æ–µ–∫—Ç–æ–º:", firebaseConfig.projectId);
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
  console.log("üî• Firebase Auth –¥–æ—Å—Ç—É–ø–µ–Ω:", !!firebase.auth);
  console.log("üî• Firebase Firestore –¥–æ—Å—Ç—É–ø–µ–Ω:", !!firebase.firestore);
</script>

<!-- –¢–≤–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç -->
<script src="script.js"></script>
    <div id="projectsModal" class="modal-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(44, 62, 80, 0.6); z-index: 3000; backdrop-filter: blur(4px); align-items: center; justify-content: center;">
    <div class="modal-content" style="background: white; padding: 30px; border-radius: 16px; width: 450px; max-width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.2); position: relative;">
        <h3 style="margin-top: 0; color: var(--dark); font-size: 20px; display: flex; align-items: center; gap: 10px;">
            üìÇ –í–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
        </h3>
        <div id="projectsListContainer" style="margin-top: 20px; max-height: 400px; overflow-y: auto; padding-right: 5px;">
            </div>
        <div style="margin-top: 25px; display: flex; justify-content: flex-end;">
            <button onclick="closeProjectsModal()" style="padding: 10px 20px; border-radius: 8px; border: none; background: #f0f2f5; color: var(--dark); cursor: pointer; font-weight: 600;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>
</body>

</html>








